<!DOCTYPE html>
<html>
  <head>
    <style>
      .image-preview {
        max-width: 100%;
        max-height: 100%;
      }
    </style>
  </head>
  <body>
    <ul class="console">
    </ul>

    <button type="button" class="tweet">Tweet!</button>

    <script src="/socket.io/socket.io.js"></script>
    <script>
      (function () {
        var remove = function () {
          var image = document.querySelector(".image-preview");
          if (image) {
            image.parentNode.removeChild(image);
          }
        };

        var show = function () {
          remove();
          var image = document.createElement("img");
          image.src = "/last_picture.jpg?_=" + new Date().getTime();
          image.className = "image-preview";
          document.body.appendChild(image);
        };

        var log = function (data) {
          var ul = document.querySelector(".console");
          var li = document.createElement("li");

          li.innerText = data.message;
          ul.appendChild(li);
        };

        var socket = io.connect("http://localhost:3000");
        socket.on("photo", show);
        socket.on("log", log);
        show();

        document.querySelector(".tweet").addEventListener("click", function () {
          fetch("/tweet", { method: "POST" });
        });
      })();
    </script>
  </body>
</html>
